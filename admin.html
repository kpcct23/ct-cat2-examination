<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - MCQ Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .hidden { display: none; }
    .container { margin-top: 50px; }
  </style>
</head>
<body>

<div class="container">
  <!-- Admin Login -->
  <div id="login-section" class="card p-4 shadow">
    <h3 class="mb-3">Admin Login</h3>
    <input type="password" id="admin-pass" class="form-control mb-3" placeholder="Enter Password">
    <button class="btn btn-primary" onclick="checkLogin()">Login</button>
  </div>

  <!-- Admin Dashboard -->
  <div id="admin-section" class="hidden">
    <h3 class="mb-4">Student Results</h3>
    <div class="mb-3 d-flex">
      <input type="text" id="search" class="form-control me-2" placeholder="Search by Name / Roll No / Subject" onkeyup="filterResults()">
      <button class="btn btn-secondary" onclick="exportCSV()">Export CSV</button>
    </div>
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Roll No</th>
          <th>Department</th>
          <th>Year</th>
          <th>Semester</th>
          <th>Subject</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody id="results-table"></tbody>
    </table>
  </div>
</div>

<script>
const ADMIN_PASSWORD = "admin123";  // Change this password
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwzMreQOMf6TCcECx4UurfJdR8IhJUEFBq-miUzd-A/dev";
let allData = [];

function checkLogin() {
  const pass = document.getElementById("admin-pass").value;
  if (pass === ADMIN_PASSWORD) {
    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("admin-section").classList.remove("hidden");
    fetchResults();
  } else {
    alert("Incorrect password");
  }
}

function fetchResults() {
  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
      allData = data;
      displayResults(data);
    })
    .catch(err => console.error(err));
}

function displayResults(data) {
  const tableBody = document.getElementById("results-table");
  tableBody.innerHTML = "";
  data.forEach(row => {
    tableBody.innerHTML += `
      <tr>
        <td>${row.name}</td>
        <td>${row.rollNo}</td>
        <td>${row.department}</td>
        <td>${row.year}</td>
        <td>${row.semester}</td>
        <td>${row.subject}</td>
        <td>${row.score}</td>
      </tr>
    `;
  });
}

function filterResults() {
  const query = document.getElementById("search").value.toLowerCase();
  const filtered = allData.filter(row =>
    row.name.toLowerCase().includes(query) ||
    row.rollNo.toLowerCase().includes(query) ||
    row.subject.toLowerCase().includes(query)
  );
  displayResults(filtered);
}

function exportCSV() {
  let csvContent = "data:text/csv;charset=utf-8,Name,Roll No,Department,Year,Semester,Subject,Score\n";
  allData.forEach(row => {
    csvContent += `${row.name},${row.rollNo},${row.department},${row.year},${row.semester},${row.subject},${row.score}\n`;
  });
  const link = document.createElement("a");
  link.setAttribute("href", encodeURI(csvContent));
  link.setAttribute("download", "mcq_results.csv");
  document.body.appendChild(link);
  link.click();
}
</script>

</body>
</html>

